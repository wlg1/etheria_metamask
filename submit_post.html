<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ETHERIA: the back page of the internet</title>
  <link rel="icon" href="./medjed-black.png">
  <link rel="stylesheet" type="text/css" href="./style.css">
  <script src="./node_modules/web3/dist/web3.min.js"></script>
  <script src='./script.js'> </script>
  <link href="https://use.fontawesome.com/releases/v5.0.7/css/all.css" rel="stylesheet">
</head>
<body onload="load_side_grid();">
  <header class='grid-white-bar'>
      <li>-</li>
  </header>
  <nav class='grid-nav'>
    <img src='./medjed-black.png' alt='X' class='reddit-pic'>
    <div class="dropdown">
    <button onclick="clickDropdown()" class="dropbtn">COMMUNITY
      <i class="fa fa-caret-down fa-fw"></i>
    </button>
    <div id="myDropdown" class="dropdown-content">
      <a href="#">[ ETHERS ]</a>
      <a href="#">[ BITCOINS ]</a>
      <a href="#">[ BLOCKCHAINS ]</a>
      <a href="#">[ BLOCKCHAINS ]</a>
      <a href="#">[ BLOCKCHAINS ]</a>
      <a href="#">[ BLOCKCHAINS ]</a>
      <a href="#">[ BLOCKCHAINS ]</a>
      <a href="#">[ BLOCKCHAINS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
      <a href="#">[ BLOCKCHAINSSSSSSSSSSSS ]</a>
    </div>
  </div>
    <div>
      <ul>
        <li id='hot-hack'>best</li>
        <li>new</li>
      </ul>
    </div>
    <p class='title'><a href="index.html" id ="to_index"><img src='./title.png' alt='ETHERIA' class='title-pic'></a></p>
    <input placeholder='SEARCH...' class='search-text-input'>
    <button class='search-button'>
      <a href='#'><img id='magnifier' src='./search.png'></a>
    </button>
    <div>
      <ul>
        <li>old</li>
        <li id='hot-hack'>worst</li>
      </ul>
    </div>
  <img src='./medjed-black.png' alt='X' class='reddit-pic'>
  </nav>
  <header class='grid-white-bar'>
      <li>-</li>
  </header>

  <div class='side-grid-left' id="side-grid-container">
  </div>

  <div class='side-grid-right'>
    <ul><a class='user-action-button' href='submit_post.html' id='to_submit_post'>POST</a></ul>
    <ul>
      <span class='as-user-style-pre'>as: </span>
      <p class='as-user-style' id='as-username'></p>
    </ul>
    <ul></ul>
    <ul></ul>
    <img src='./right_joystick.png' alt='REDDIT' class='reddit-pic'>
  </div>

  <div class="post-input">
  <label class="labels">TITLE</label>
  <textarea id="user-title-input" class = "post-input-box" type="text" cols="40" rows="1"></textarea>
  <br></br>
  <label class="labels">POST</label>
  <textarea id="user-post-input" class = "post-input-box" type="text" cols="40" rows="5"></textarea>
  <button id="post-button" class = "comment-button">SUBMIT POST</button>
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

  <script>
  window.addEventListener('load', async () => {
      // Modern dapp browsers...
      if (window.ethereum) {
          window.web3 = new Web3(ethereum);
          try {
              // Request account access if needed
              await ethereum.enable();
              // Acccounts now exposed
              web3.eth.sendTransaction({/* ... */});
          } catch (error) {
              // User denied account access...
          }
      }
      // Legacy dapp browsers...
      else if (window.web3) {
          window.web3 = new Web3(web3.currentProvider);
          // Acccounts always exposed
          web3.eth.sendTransaction({/* ... */});
      }
      // Non-dapp browsers...
      else {
          console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
      }
  });

 if (typeof web3 !== 'undefined') {
     web3 = new Web3(web3.currentProvider);
 } else {
     web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
 }

 web3.eth.defaultAccount = web3.eth.accounts[0];

 var ContractVar = web3.eth.contract([
  {
    "constant": true,
    "inputs": [
      {
        "name": "_commentnum",
        "type": "uint256"
      },
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "getCommentTime",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_commentnum",
        "type": "uint256"
      },
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "voteCommentUp",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "name": "userMap",
    "outputs": [
      {
        "name": "name",
        "type": "bytes32"
      },
      {
        "name": "signedup",
        "type": "bool"
      },
      {
        "name": "id",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "votePostUp",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "_commentID",
        "type": "int256"
      }
    ],
    "name": "getCommentByID",
    "outputs": [
      {
        "name": "",
        "type": "int256"
      },
      {
        "name": "",
        "type": "bytes32"
      },
      {
        "name": "",
        "type": "bytes32"
      },
      {
        "name": "",
        "type": "bytes32"
      },
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "timearr",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "votearr",
    "outputs": [
      {
        "name": "",
        "type": "int256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getPosts",
    "outputs": [
      {
        "name": "",
        "type": "int256[]"
      },
      {
        "name": "",
        "type": "bytes32[]"
      },
      {
        "name": "",
        "type": "bytes32[]"
      },
      {
        "name": "",
        "type": "bytes32[]"
      },
      {
        "name": "",
        "type": "address[]"
      },
      {
        "name": "",
        "type": "bytes32[]"
      },
      {
        "name": "",
        "type": "uint256[]"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "_commentnum",
        "type": "uint256"
      },
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "getCommentVotes",
    "outputs": [
      {
        "name": "",
        "type": "int256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "userAddresses",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_name",
        "type": "bytes32"
      }
    ],
    "name": "signup",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "_address",
        "type": "address"
      }
    ],
    "name": "getUser",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      },
      {
        "name": "",
        "type": "uint256[]"
      },
      {
        "name": "",
        "type": "int256[]"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "addressposts",
    "outputs": [
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "authorarr",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "_name",
        "type": "bytes32"
      }
    ],
    "name": "checkIfUser",
    "outputs": [
      {
        "name": "",
        "type": "int256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "loggedin",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_commentstring",
        "type": "bytes32"
      },
      {
        "name": "_time",
        "type": "bytes32"
      },
      {
        "name": "_loggedin",
        "type": "uint256"
      },
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "addComment",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "_commentnum",
        "type": "uint256"
      },
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "getCommentContent",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "countComments",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "login",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "_commentnum",
        "type": "uint256"
      },
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "getCommentAuthor",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      },
      {
        "name": "",
        "type": "bytes32"
      },
      {
        "name": "",
        "type": "address"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_postnum",
        "type": "uint256"
      },
      {
        "name": "_title",
        "type": "bytes32"
      },
      {
        "name": "_poststring",
        "type": "bytes32"
      },
      {
        "name": "_time",
        "type": "bytes32"
      },
      {
        "name": "_loggedin",
        "type": "uint256"
      }
    ],
    "name": "addPost",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "name": "takenUsernames",
    "outputs": [
      {
        "name": "",
        "type": "bool"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "postarr",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_commentnum",
        "type": "uint256"
      },
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "voteCommentDown",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "countPosts",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "getAllUsers",
    "outputs": [
      {
        "name": "",
        "type": "address[]"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "name": "titlearr",
    "outputs": [
      {
        "name": "",
        "type": "bytes32"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {
        "name": "_postnum",
        "type": "uint256"
      }
    ],
    "name": "votePostDown",
    "outputs": [],
    "payable": false,
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "anonymous": false,
    "inputs": [],
    "name": "updatePage",
    "type": "event"
  }
]);

 var first_contract = ContractVar.at('0x0d7d1a126bd4b99ac2127980f1325080e5efbb2a');

 console.log(first_contract);

  function getParameterByName(name) {
      var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
      return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
  }
 var uname = getParameterByName('uname');
 if (uname != undefined){
      var logged_in = 1;
 } else{
      var logged_in = 0;
  }

  function load_side_grid(){
  if (uname != undefined){
    var str =  `<ul><a id='to_profile' class='user-action-button' href='#'>PROFILE</a></ul>
      <ul><a class='user-action-button-2' href='#'>SETTINGS</a></ul>
      <ul><a class='user-action-button-2' href='submit_post.html' onclick='logout()'>LOGOUT</a></ul>
      <ul></ul>
      <img src='./left_joystick.png' alt='X' class='reddit-pic'>`
      document.getElementById("side-grid-container").innerHTML = str; 
      document.getElementById("as-username").className = "as-user-style";
      document.getElementById('as-username').innerHTML = uname.slice(0, 10);
      document.getElementById("to_profile").href="profile.html?uname="+uname+"&disp_name=" + uname +'&addr='+web3.eth.defaultAccount;
      document.getElementById("to_submit_post").href="submit_post.html?uname=" + uname;
      document.getElementById("to_index").href="index.html?uname=" + uname;
  } else {
    var str =  `<ul><a class='user-action-button' href='login.html'>LOGIN</a></ul>
      <ul><a class='user-action-button-2' href='#'>SETTINGS</a></ul>
      <ul></ul>
      <img src='./left_joystick.png' alt='X' class='reddit-pic'>`
      document.getElementById("side-grid-container").innerHTML = str;
      document.getElementById("as-username").className = "as-user-style-2";
      document.getElementById('as-username').innerHTML = "Anon";
  }
 }

 $("#post-button").click(function() {
  first_contract.countPosts(function(error, result){
      var counter = 0;
      for (i = 0; i < result; i++) {
        counter++;
      }
      var today = new Date();
      var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
      var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
      var datee = date+'\xa0\xa0\xa0\xa0'+time;
      first_contract.addPost(counter,$("#user-title-input").val(),$("#user-post-input").val(),datee, logged_in, function(error, result){});
      $('#user-title-input').val('')
      $('#user-post-input').val('')
 });
})

</script>

</body>
</html>
